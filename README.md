# 六自由度机械臂控制系统  
## 设计内容及指标  
​	实现机械臂“点到点”的运动，在PC端通过串口助手发送机械臂可达到范围内的任意指定坐标，使机械臂运动到相应的点。  

设计内容：  

1. 根据机械臂的机械结构建立合理的空间坐标系，这样就能用一个3×1的位置矢量定义机械臂周围空间的任何一点。  

2. PC端向机械臂控制板发送任意一个可达位置的坐标时，机械臂系统能通过逆运动学求解出每个关节的转角，并控制舵机转动使得末端执行器能够平稳地运动到目标位置。  

3. 融合超声波模块的信息，超声波模块检测目标物体距离机械臂的距离，当PC端发送抓取目标的指令后，机械臂进行抓取目标操作。

   

## 设计概述  
​	本系统最终要实现使机械臂抓取目标物体的目的，即要使机械臂末端能达到指定的位置，因此进行的第一步就是根据目标点的位置求解出机械臂各个关节所需达到的目标位置，为实现这一步，需要先建立合理的空间坐标系，其次在这个坐标系中进行逆运动学求解（D-H参数求解，MATLAB的Robotis Toolbox工具箱进行验证）；完成上述解算过程后，进行第二步操作，控制器发送控制信号给各个舵机，使它们运动到指定的位置，再执行相应的抓取操作等。



## 硬件平台 
​	本设计是基于“海灵智电”公司的“STM32版6自由度机械臂（PWM舵机版本）”平台进行控制系统开发，所使用的6自由度机械臂主要由铝合金支架，金属舵盘，杯式轴承，合金铝爪以及舵机构成。配上控制器，可以让机械臂进行各种动作。例如抓取，移动等等。能模仿人手和臂的某些动作功能，用以按固定程序抓取、搬运物件或操作工具的自动操作装置。  

​	系统的硬件控制器采用STM32F103C8T6作为主控芯片，当接收到上位机（PC）发送来的信息后，将其解析成舵机控制信号进而对机械臂进行控制。  

​	对于舵机的驱动，主控器产生周期为20ms、脉宽为0.5ms-2.5ms的PWM波，驱动机械臂上的所及实现0-270°的旋转。舵机接收到PWM信号后通过双H桥电路驱动内部电机转动，并通过电位计实现舵机系统的闭环。  

​	对于传感器的使用，系统中使用了HY-SRF05超声波测距模块用于检测目标物体的距离，此模块可提供2cm-450cm的非接触式距离感测功能，测距精度可达到3mm。采用TRIG口出发测距，模块将自动发送8个40kHz的方波，自动检测是否有信号返回，有信号返回，通过ECHO输出一个高电平，高电平持续时间就是超声波从发射到返回的时间。


$$
\begin{array}{c|lcr}
\text{引脚} & \text{功能}\\
\hline
\text{PB6} & \text{1号舵机信号线} \\
\text{PB7} & \text{2号舵机信号线} \\
\text{PB8} & \text{3号舵机信号线} \\
\text{PB9} & \text{4号舵机信号线} \\
\text{PA0} & \text{5号舵机信号线} \\
\text{PA1} & \text{6号舵机信号线} \\
\text{PB3} & \text{触发控制超声波模块} \\
\text{PB5} & \text{接收超声波模块回响信号} \\
\text{PB13} & \text{蜂鸣器} \\
\text{PB14} & \text{LED} \\
\text{USART1(PA9/ PA10)} & \text{6号舵机信号线} \\
\text{TIM2} & \text{定时中断实现控制多路舵机} \\
\end{array}
$$


## 串口通信  

​	串口通信部分作为系统的核心，机械臂所要执行的一切操作都是由上位机指定的，指令的种类一共有6类，指令的长度也不同，其中第一类指令的作用是使机械臂末端运动到空间中指定的位置，因此指令中包含了位置信息，想要机械臂按照操作者的意愿执行操作，必须得保证串口通信过程中不能丢失数据，即使丢失了数据也能得甄别出来，尤其是一些大型的机械臂，如果收到了错误的数据，可能会造成一些不可逆转的损失，因此串口通信数据接收的正确性是及其重要的，为了保证以上要求，首先需要指定一个合理的通信协议。在此设计中，机械臂执行的基本上是一些简单的操作，因此协议并不复杂，协议格式如下图所示，通信协议的具体内容如下表所示。

![image-20230330204300737](https://github.com/shiguangqianmo/6-DOF-Manipulator/blob/main/pic/data_format.png?raw=true)

![image-20230330204803402](https://github.com/shiguangqianmo/6-DOF-Manipulator/blob/main/pic/protocol_format.png?raw=true)



由上表很容易观察出，只有当指令类型为0x01时，数据包的长度才为6，其他情况数据包长度均为3，因此只有0x01指令是可变的，其余5条指令均为固定的，如下表所示：

![image-20230330204850973](https://github.com/shiguangqianmo/6-DOF-Manipulator/blob/main/pic/protocol_content.png?raw=true)
